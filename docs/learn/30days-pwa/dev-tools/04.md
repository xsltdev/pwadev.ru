# Средства отладки #2

Добро пожаловать на **Неделю 3 День 4** из #30DaysOfPWA! Хотите узнать больше об этом проекте? Ознакомьтесь с нашим постом [Kickoff](../index.md), чтобы получить более подробную информацию о дорожной карте и контрибьюторах. А теперь давайте погрузимся в работу!

![Добро пожаловать на неделю 3, день 4 - Инструменты отладки, часть 2.](_media/day-04.jpg)

Добро пожаловать на второй день отладки PWA с помощью браузерных DevTools!

Вчера вы научились отлаживать типичные проблемы, связанные с PWA, с помощью DevTools. Однако, как вы узнали из [week 2](../advanced-capabilities/index.md) этой серии, PWA способны на более сложные функции, такие как [background synchronization](../advanced-capabilities/06.md), [push notifications](../advanced-capabilities/07.md) и другие.

Сегодня мы рассмотрим доступные инструменты для отладки этих расширенных возможностей PWA.

|  | Что вы узнаете сегодня |
| :-- | :-- |
| _Разрешения PWA_ | Как проверить наличие разрешений PWA |
| _Управление уведомлениями_ | Как эмулировать push-уведомления |
| _Фоновая синхронизация и выборка_ | Как просматривать события фоновой синхронизации и выборки |
| _Хранилище в IndexedDB_ | Как просматривать и управлять данными, хранящимися в IndexedDB |

---

Обратите внимание, что все скриншоты в сегодняшней статье взяты из Microsoft Edge DevTools, но и другие браузеры предлагают аналогичные инструменты.

## Управление разрешениями PWA

PWA могут в полной мере использовать такие современные веб-функции, как уведомления, определение местоположения и хранение данных, однако для того, чтобы PWA могли использовать эти функции, им необходимо предоставить соответствующие разрешения.

Например, для отправки уведомлений пользователю PWA должен запросить разрешение через [Notifications API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/Notifications_API), что выглядит примерно так:

```javascript
Notification.requestPermission().then(function (result) {
    console.log(result);
});
```

В результате браузеры будут показывать диалог, запрашивающий у пользователя разрешение, как показано ниже.

![Диалог разрешений в Microsoft Edge, предлагающий пользователю разрешить или запретить уведомления с сайта.](_media/day-04-permission-dialog.png)

В процессе разработки часто возникает необходимость протестировать различные пользовательские потоки в зависимости от того, разрешил или запретил пользователь определенные разрешения. Для этого можно использовать список **App permissions**. С помощью этого списка можно подтвердить и управлять всеми разрешениями, которые использует ваше приложение.

Например, чтобы сбросить разрешение на уведомления:

-   Откройте страницу **Празрешения приложения**, нажав на значок **Просмотр информации о сайте** в строке url или на кнопку меню **Настройки и многое другое** в строке заголовка установленного PWA.
-   Найдите в списке пункт **Уведомления** и верните его к значению по умолчанию.
-   Также можно сбросить все разрешения, нажав кнопку **Сбросить разрешения**.

![Шаги по открытию списка разрешений приложений и сбросу разрешения на уведомления в Microsoft Edge](_media/day-04-all-permission.png)

## Push-уведомления

Как вы узнали в разделе [Уведомление пользователей об обновлениях](../advanced-capabilities/07.md), PWA могут повысить вовлеченность пользователей за счет отправки им push-уведомлений. Для этого используются [Push API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/Push_API) и [Notifications API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/Notifications_API), которые доступны сервис-воркерам.

PWA могут подписываться на push-сообщения с сервера через Push API. После подписки PWA начнет получать push-события, даже если приложение закрыто. При получении push-события PWA может отправить пользователю уведомление через Notifications API.

DevTools может отслеживать все эти события, что поможет вам отладить весь поток уведомлений пользователя. Чтобы просмотреть список всех push-сообщений и уведомлений в DevTools:

-   Откройте DevTools.
-   Откройте инструмент **Приложения**.
-   Откройте **Push-сообщения** в разделе **Фоновые сервисы**.
-   Нажмите **Начать запись событий**, чтобы начать перечисление событий push-уведомлений в таблице.
-   Для уведомлений откройте **Уведомления** в разделе **Фоновые сервисы** и нажмите **Начать запись событий**.
-   Нажмите на любое уведомление для просмотра подробностей.

![Шаги для просмотра списка Push-сообщений и уведомлений в Microsoft Edge DevTools](_media/day-04-notifications-table.png)

Поскольку события push должны запускаться сервером, для тестирования и отладки потока push-сообщений в PWA часто приходится отправлять имитацию событий с сервера.

DevTools предоставляет удобный способ избежать этого, имитируя отправку push-событий непосредственно из браузера. Чтобы отправить имитацию push-событий в PWA, выполните следующие действия:

-   Откройте DevTools и откройте инструмент **Application**.
-   Откройте раздел **Сервисы-воркеры** в секции **Приложение**.
-   Введите тестовое сообщение в поле ввода **Push**.
-   Нажмите кнопку **Push**, чтобы отправить сообщение.
-   Затем вы можете проверить, что событие было отправлено, в таблице **Push messaging**, как описано выше.

![Имитация push-сообщений в Microsoft Edge DevTools.](_media/day-04-push-messages-mock.png)

## Фоновая синхронизация и выборка

PWA также могут использовать [Background Sync API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/en-US/docs/Web/API/Background_Synchronization_API), [Background Fetch API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/Background_Fetch_API) и [Periodic Background Sync API](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/Web_Periodic_Background_Synchronization_API) для отправки и получения сетевых запросов и сообщений.

Преимущество использования этих фоновых API перед Fetch или XMLHttpRequest заключается в том, что сетевые запросы, выполняемые через эти API, могут быть отложены до момента активного подключения PWA к сети и выполняться даже тогда, когда PWA не используется. Дополнительную информацию см. в разделе [Синхронизация данных приложения в фоновом режиме](../advanced-capabilities/06.md).

Аналогично тому, как можно просматривать push-сообщения и уведомления, события Background API также можно просматривать в DevTools. Раздел **Background services** инструмента **Application** имеет 3 подраздела:

-   **Background Fetch** позволяет записывать события фоновой выборки.
-   **Background Sync** позволяет записывать события фоновой синхронизации.
-   **Periodic Background Sync** позволяет записывать периодические события фоновой синхронизации.

В разделе **Сервисы-воркеры** можно также отправлять тестовые события фоновой синхронизации и периодические события фоновой синхронизации, что работает аналогично отправке тестовых push-сообщений, как было описано ранее.

Эти события запускают все обработчики событий в PWA, а также попадают в соответствующую таблицу фоновых служб.

![Фоновая синхронизация в Microsoft Edge DevTools.](_media/day-04-background-services.png)

## Хранилище IndexedDB

Для обеспечения поддержки автономной работы PWA должны иметь возможность локального хранения данных. В Интернете существует множество вариантов хранения данных, подробнее о которых можно прочитать [здесь](../core-concepts/05.md).

В PWA рекомендуется использовать хранилище [Cache storage](../advanced-capabilities/05.md) для хранения статических ресурсов и [IndexedDB](https://aka.ms/learn-PWA/30Days-3.4/developer.mozilla.org/docs/Web/API/IndexedDB_API) - для более структурированных данных. Более подробно об IndexedDB можно узнать из готовящейся статьи [Лучшие практики надежности](../platforms-practices/04.md).```

[Вчера](./03.md) вы узнали об отладке проблем с кэшем в DevTools. Для просмотра и управления данными IndexedDB вашего приложения в DevTools:

-   Откройте DevTools
-   Откройте инструмент **Application**.
-   В разделе **Storage** раскройте секцию **IndexedDB**, пока не найдете свою базу данных и таблицу, которую хотите открыть. Обратите внимание, что здесь может быть несколько баз данных.
-   Ваша таблица появится в основной области инструмента, и вы сможете просмотреть данные.
-   С помощью панели инструментов, расположенной в верхней части таблицы, можно очистить всю таблицу или удалить выделенную строку.

![Шаги по просмотру данных indexedDB в DevTools.](_media/day-04-indexeddb.png)

## Резюме

После прочтения вчерашней и сегодняшней статей этого цикла вы должны иметь представление о том, как браузер DevTools может быть использован для разработки и отладки PWA. Многие проблемы PWA можно решить с помощью DevTools, а разработка может быть упрощена благодаря использованию специализированных инструментов, которые мы рассмотрели в предыдущих двух днях.

Набор функций, доступных для PWA, постоянно растет, и в DevTools планируется добавить инструментальную поддержку этих новых возможностей. Если у вас есть пожелания по функциям или отзывы, вы можете связаться с командой Microsoft Edge DevTools, нажав кнопку **Отправить отзыв** в правом верхнем углу DevTools.
